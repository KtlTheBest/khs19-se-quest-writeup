# Write up

Я пишу врайтап на СТФ от организаторов (KazHackStan)[kazhackstan.kz]. Я решил всего несколько тасков, для меня интерес представляет task.dll. Данный CTF не предпологает что вы умеете пользоватся metasploit (по крайней мере до того уровня до которого я дошел).

Окей, приступим.

## Начало
Чтобы начать участвовать, надо было отправить /start боту sidorovich_khs_bot в телеграмме. Он отправит нам такое сообщение:
```
Ходят слухи, что недавно с Балхашской АЭС были слиты важные данные. Возможно здесь есть связь с Пушкинской группировкой, или нет, но нужно проверить. Новые админы АЭС увидели в логах сервера запись о создании zip-архива, а что в него положили не известно, остальное подтёрли...

Вы:Продолжить

Не перебивай, я не закончил.
Есть подозрения что это персональные данные сотрудников АЭС, но буду честен мне на них плевать, на сотрудников, понимаешь ? На сервере были чертежи самой АЭС ! Случится катастрофа если они попадут не в те руки. Это поставит под угрозу всю область !

Совсем недавно мы уволили нашего старшего системного администратора. Тупой бездельник сайты хреново писал. Представляешь, в голосовалке не сделал защиты от накрутки ! Контакты с ним утеряны, ну как утеряны, мы его за халатность уволили, а он взял да скрылся. После его увольнения по случайности, а может нет, данные сотрудников и пропали. Выборочно как то, в общем нет записей об этом админе. Я не исключаю возможности, что это он украл данные и подтёр всё за собой.

Вы:Я в деле !

Молодец! Я знал что на тебя можно положиться, хехе.
 Вот информация которая мне нужна:
-Ссылка на профиль админа с его резюме.
-Новое место работы админа.
-Место, где админа можно поймать с поличным.
-Ссылку на его репозиторий.
-Один из его секретных usernam'ов
-Данные из архива

Знаешь я тут вспомнил, есть старый сайт этого админа, он там какой то конкурс устраивать собирался. кажется валяется dev версия на каком то сервере. Держи ссылку на его сайт. Может это тебе поможет...
http://balnpp4.kz/
```

## Первый флаг
Окей. На данный момент я не совсем понял что нам нужно, но мы знаем с чего начинать. (Сайт)[http://balnpp4.kz] очень похож на сайт который был недавно для накрутки голосов. Однако я не совсем уверен что он функциональный как прошлый сайт (я решил не проверять). Первым делом смотрим в код страницы и находим кое что интересное
```
function getData(pageNumber) {
            $.ajax({
                type: "GET",
                url: "/page/" + pageNumber,
                cache: false,
                success: function (html) {
                    $("#profiles").html(html);
                }
            });
        }

        $(document).ready(function () {
            getData(1);
            // alert("ХОЧЕШЬ ТАКОЙ ЖЕ ОФИГЕННЫЙ САЙТ ? ИЩЕШЬ СУПЕР-АДМИНА ? ПЕРЕХОДИ: https://www.linkedin.com/in/%D0%B0%D0%BB%D0%B5%D0%BA%D1%81%D0%B5%D0%B9-%D1%89%D0%B5%D1%80%D0%B1%D0%B0%D0%BA%D0%BE%D0%B2-57a4bb195/ {FLAG:LINKED}");
        });
```

Мы видим ссылку на резюме работника и рядом флаг. Нам не нужно отправлять юзернейм, только флаг. В этом плане очень удобно.
```
Молодец, ты нашёл ссылку на linkedIn нашего "героя"! 
Держи 5 алтынов
```

## Второй флаг
Окей, очевидно что у нас снова нет зацепок кроме резюме, поэтому переходим на linkedin. Там нас ждет ссылка: 
```
```
Она ведет нас на (github)[https://github.com/tagged-19-19]. Первое что вы должны заметить это description юзера.
```
{FLAG:OH_MY_GIT}

Агааа, вот куда он заливал свой говнокод! Ну и помойка =Р 
Держи 5 алтынов
```

## Третий флаг
Окей, теперь у нас есть гитхаб. Наверняка здесь должно быть что-то интересное. Еще юзер был создан совсем недавно. Скорее всего это то что нам нужно. Если поищем, то заметим 3 репозитория. Два из них пустые (форкать их нет смысла) кроме одного. Репозиторий называется bbs. Если загуглить, то можно найти похожий (репозиторий)[https://github.com/ElisDN/yii2-demo-shop]. На глаз они действительно очень похожи. Однако у одного много коммитов, а у другого два. Мы же понимаем какой нам надо изучить? :)

Если посмотрим commit history, то можно заметить, что один commit это init, а другой что-то меняет. Можем посмотреть что меняется. Среди интересных изменений есть такие вкусности
```
    // public function actionIndexTest(): User
    // {
    //     $this->sn_username = "alexst4l";
    //     return $this->serializeUser($this->findModel());
    //     $flag = "{F"."L"."A"."G:"."Malurus_splendens"."}"
    // }
```

Вот он наш флаг, однако нам надо все флаги сдавать в формате `{FLAG:BLABLA}`.
```
{FLAG:Malurus_splendens}

Хм, ещё один username ? Посмотрим куда он ведёт. Держи 10 алтынов
```

Хм, юзернейм?

## Четвертый флаг
Я решил оставить на данный момент гитхаб и посмотреть что у нас еще есть. Если поизучать резюме, то можно заметить что там указано место работы: **barburstroy**. Гугл запрос показывает всего два результата. Один из них какой-то nic сайт. Мы не сможем на него перейти (по крайней мере я не смог). В начале браузер говорит что с сертификатом что-то не то (ага). Когда же мы игнорируем предупреждения браузера, нас перекидывает на главную страницу гугла. Окей, что еще мы можем сделать? Кто-то может просто тыкнуть пальцем в небо, а кто-то может снова посмотреть на результаты гугла, и увидеть адрес (barburstroy.kz)[http://barburstroy.kz]. Nmap нам мало что дает. Попробуем запустить dirbuster. Находим две страницы. Одна из них это robots.txt.
```
{FLAG:barburbir}

Теперь мы знаем куда он устроился бездельничать! 
Держи 10 алтынов
```

## Пятый флаг
Второй файл который мы находим это config.php. Смешно что мы можем его скачать. Открывая его, мы видим ссылку на google drive. Там мы получаем eml файл. Окей, быстрый гугл запрос показывает что данный файл можно октрыть plain текстом. Там хедеры письма и какой-то текст в base64. Мы можем легко получить из base64 в обычный текст. Получаем данный флаг:
```
{FLAG:some_kanagat_cafe}

Ого, да тут и вправду замешаны Пушкинские. Да это ж просто находка! 
Держи 15 алтынов
```

## Шестой флаг
Окей, зачем нам нужен username? Я думал что возможно этот юзернейм может понадобиться для какой-то странички авторизации. Может быть он все еще может понадобиться. Однако в данном случае все проще. Кто-то может снова тыкнуть пальцем в небо, или можно сделать по нормальному. Благо есть OSINT. Нам понадобится (Sherlock)[https://github.com/sherlock-project/sherlock]. Это удобная тулза которая может проверить username в разных соцсетях. Передаем Шерлоку юзернейм который мы нашли (alexst4l) и ждем. Ждем. Ждем. Ждем... Опа. Он должен показать что данный юзернейм есть в (Твиттере)[https://twitter.com/alexst4l]. Там всего один твит с просьбой о помощи настроить nginx сервер по адресу 3.122.233.125. Введя данный айпи в адресную строку, перед нами открывается страница с ошибкой... и флаг :)

```
{FLAG:some_secret_username}

Так вот кто писал "Я против постройки АЭС". Теперь то он узнает что такое свобода слова.
Держи 5 алтынов
```

## Седьмой флаг
Помимо главной сюжетной линии, Сидорович отправляет данные сообщения:
```
И эт самое, поторопись ! Заказчики уже начинают нервничать:
@id565860072: Сидорович, ну чё там ?! Когда уже твои сыщики отработают ?

Слушай, у моего заказчика есть для тебя просьба. С машиной у неё проблемы, кажись ворованную продали. Помоги найти vin, а то она сама не может найти. За помощь отблагодарю !

Слушай, Меченый, есть ещё дело: 
К этой машине идёт прошивка, а вот что бы завести её - надо постараться. Вся тобой собранная информация даст тебе возможность разобраться с прошивкой. Удачи.
```

Окей. О какой машине идет речь? Смотря кому пренадлежит данный id (очень не характерный для телеграма) мы видим что он пренадлежит Ане Петровне. Окей, что дальше? Данный id ничего не напоминает? Можете попробовать передать данный id нашему Шерлоку или вы можете по интуиции понять что это (vk id)[https://vk.com/id565860072]. Перейдя по id, мы видим что страничка пренадлежит нашей Ане Петровне. Окей, мы на правильном пути. На странице ничего нет, кроме фотографий машин. На них ничего нет, кроме одной. Номер 013ADM37. Окей, первое что должно придти на ум это пробить этот номер. Однако явно что этого номера не существует, ничего не выйти не должно. Тогда где же пробивать? Кто следит за каналом Крышесносы Морти, там есть один пост: может закрыть **findvinbot**? Однако бот который используется для пробивки называется **getvin_bot**. То есть findvinbot это бот созданный специально для этого квеста. Пробиваем номер в этом боте и забираем наш флаг:
```
{FLAG:d0n4tsZ_kolesa}

Ооооо, спасибо что помог! Что бы вы, люди, без нас, ботов, делали ?) Держи 5 алтынов
```

## Продолжение
At this point, мы понимаем что нам осталось решить только task.dll. Однако я не знаю как это решать.
